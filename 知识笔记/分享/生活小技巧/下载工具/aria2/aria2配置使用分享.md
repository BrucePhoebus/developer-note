<!--
 * @Date: 2021-04-25 10:16:49
 * @LastEditors: 郑烨锟
 * @LastEditTime: 2021-04-25 17:34:25
 * @tags: 	
 *  - 分享
 *  - aria2
 *  - 下载
-->
# aria2配置使用分享

> 直接有效参考：[Windows下安装运行Aria2一整套解决方案](https://cikeblog.com/windows-run-aria2.html)

## 过程中的问题与思考

#### aria2是什么

* Aria2 是一个多平台轻量级，支持 HTTP、FTP、BitTorrent 等多协议、多来源的命令行下载工具

> 这个过程可以最大限度利用带宽，并且非常轻量，资源占用少

#### 脱机下载

* 之前听到说离线下载/脱机下载，什么鬼，后来发现，就是使用aria2服务器去下载比较遥远的服务器上的文件，这样能加快直接使用其他工具(迅雷/浏览器)下载的速度

* 浏览器是属于客户端，迅雷虽然也是客户端，但是迅雷有自己的服务器，如果资源多，那么迅雷下载速度就快，但是要收费，这就尴尬了

* 所以会使用aria2下载就是解决迅雷收费的问题，我们可以使用aria2服务器去对等服务器下载资源，当然，有些资源需要权限下载，这也就是后面说的高速百度云下载的时候需要登录的原因，让aria2作为服务器去对方的服务器拿资源，这样就快很多，然后我们再从aria2服务器把资源下载下来

#### 原理

* 网上可以查到aria2原理层面是支持多种下载协议的，也就是这个应用是开放出多个接口对接这下载类型的：`HTTP(S)`, `FTP`, `SFTP`, `BitTorrent`,和`Metalink`协议

* 然后看了下`aria2.conf`文件，里面很多服务器地址，都是用来支持多数据源下载的

* 而且看下载方式，可以同时从`HTTP(S)`/`FTP`/`SFTP`和`BitTorrent`协议路径上下载同一个文件，因为数据是可以使用块传输的，然后进行`Metalink`块校验和拼装成一个文件

* 原理是使用aria2的服务器去下载资源，然后在把aria2服务器下载到的资源下载到本地

* 那么本地aria2服务器的意义是什么？应该也是以服务器对接服务器去下载资源，这样也会快一些，而如果能直接从百度云服务器、迅雷服务器拿到授权了的下载地址，那么也就能以比较快的速度下载，至于下载速度，或许跟授权的速度(例如百度云VIP对应的下载速度)和自己网络带宽(网速)有关

> 可以从操作节目设置的服务器信息看到一堆支持的功能

#### 最大的问题或许就是配置麻烦了，极度不友好

* 虽然有很好的集成工具，但是也需要一定专业的配置认知，如果没有仔细的教程的话，就会很痛苦，当然，跟一个人研究解决复杂问题的能力相匹配

* 不同的教程、不同的版本、不同人集成后的版本需要不一样的配置

* 官方版本给予的就比较自由化，虽然给了懒人版本，但是依旧需要配置一些东西，不看教程，你都不知道怎么运行

###### 例如：官方版本看教程说要配置几个文件

```bash
aria2.conf
Aria2.log
aria2.session
HideRun.vbs
```

* 当然，最重要的是aria2.conf，然后有HideRun.vbs的运行配置

* 然后我发现aria2c.exe运行不了，结果运行HideRun.vbs好像可以，但是这需要看任务管理器才能发现这个进程，对普通人简直是无法使用

* 当然，如果他参考教程，去打开aria2封装好的桌面版应用或PC网页版查看(到处都有得下)，倒是或许看到，哎，好像可以下载了，但是，这速度，还有百度云/迅雷要怎么下呢

###### 后续依旧要很多配置

* 然后，发现或许又需要配置，需要配置路径，有些需要配置token

* 而我们使用这个工具常常是想解决百度云或迅雷的下载速度问题，然而，我看到都一脸坑，一堆插件，一堆工具，还有好多都不能用的，这。。。

#### 实际上，很多集成工具可以简单下载，但是意义有限

* 上面这个解决方案是我发现最全的包了，一键start运行，然后会打开cmd窗口看到效果，然后按教程双击打开起来应用，就能界面操作，非常友好

* 慢慢的也看懂这些命令与配置，但是依旧还是不知道怎么比较好的下载迅雷和百度云

#### 关于PanDownload这个百度云高速下载工具与aria2

* 看了下网友关于这个的分析与参考同样的方式制作类似的高速下载工具思路

* 原来`PanDownload`就是使用百度云VIP高速解析获取VIP下载地址，然后使用aria2进行下载，所以就可以封装实现，当然，由于百度云有检查，所以需要用户登录(安全问题)

> [原创分享aria2满速下载百度云原理和PanDownload一样](https://bbs.125.la/thread-14166034-1-1.html)

* 当然，后面封装好的大佬的东西发现不能用了，这个也有使用难度，不过，看这原理，aria2的价值可想而知

#### aria2c是啥

* aria2c是aria2的运行命令，当然也有aria2c.exe这个文件，类似Java的javac，执行命令的一种方式

```bash
# aria2c执行下载文件
aria2c http://host/image.iso
# aria2c执行本地种子文件下载
aria2c -u40K /path/to/file.torrent
```

#### 我修改的配置

###### dir 修改文件保存路径 和 .aria2后缀文件

```bash
# aria2.conf配置文件
dir=C:\Users\Zheng\Desktop
```

> 默认是`download`，默认下载到当前项目根路径下，没有会自动创建一个`download`文件夹，直接去配置文件改到桌面

* 后来想了想，还是留下记录吧，使用`aria2`下载会因为`force-save`配置而多产生一个.aria2后缀的文件，这个文件有记录效果，想了下，还是保存在相对路径吧，还是有需求的，该回去

```bash
dir=download
```

###### 设置授权令牌：rpc-secret

```bash
# 值是：secret
rpc-secret=secret
```

> 发现一个谷歌迅雷插件一定要添加服务器地址(正常)，但是一定要`token`(对应令牌)就莫名其妙了，然后只能加上：`http://token:secret@localhost:6800/jsonrpc`

> 旧版本是使用用户名和密码的，现在改为了直接使用密码令牌

* 只是后面对应的`webui-aria2`等操作应用也需要改配置，也就是操作界面的可选密码令牌也要加上，直接修改它的配置文件，在auth对象中加入

```js
auth: {
  // 就是这个梗
  // token: '$YOUR_SECRET_TOKEN$'
  token: 'secret'
  /*-----------------------------*/
  // user: '*YOUR_USERNAME*',
  // pass: '*YOUR_SECRET_PASS*'
},
```

#### 工具问题

* 使用这个PC下载工具重启`aria2`服务后发现一个问题，那就是刷新操作页面页面，列表中的下载请求会重新请求一遍，下载成功的也会重新请求，那也就是说下载成功后，下载记录就删了吧，这是不符合逻辑的

## 功能

#### 外网文件下载

* 例如谷歌路径的一些文件下载不了，可以直接用这个下，下过一些，都OK

#### 百度网盘文件下载解决方案

  网上有很多解决方案，例如`PanDownload`，但是既然用`aria2`，就不要完全封装的吧

* 当然，发现还是要找个可以获取百度网盘直接下载的链接，找了很久，多数插件都被干翻了

###### 百度网盘简易下载助手

> [百度网盘简易下载助手](https://greasyfork.org/zh-CN/scripts/418182-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%AE%80%E6%98%93%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B-%E7%9B%B4%E9%93%BE%E4%B8%8B%E8%BD%BD%E5%A4%8D%E6%B4%BB%E7%89%88)

* 这是难得找到了可以获得直链地址的插件

* 安装之后，虽然要保存到自己百度网盘，应该是通过这样的办法解决登录问题，也就是我们依旧要登录，这个时候当然是PC端，自己在官方登录，而不是别人的平台登录，当然`PanDownload`也是可以授权而不输入账号密码的

* 安装成功之后刷新自己百度网盘文件位置地址可以看到红色按钮`简易下载助手`，选中文件可以通过人机认证后获得直链地址

* 当然，自己本地有运行aria2服务的，可以直接配置aria2，优秀啊，直接支持

* 因为使用过程中发现，有时会获取链接失败，有时候拿着链接去下载也会下载失败，但是直接配置aria2去下载，成功率较高，当然也可能这个服务有点小问题，不稳定

* 但是能解决网盘下载问题，杠杠的

* 最后发现下载几百M的文件，速度能7M+/s，当然，我相信这是受限于带宽，或许能更快

> 最后，几次没有生成1G的直链链接，这不知道是哪方面的问题，怀疑是百度网盘限制力度，但是多数人间这样也不错了

> 对于大文件，还是建议可以考虑压缩多个拆分，降低文件大小，这样就容易下了，搞得上去麻烦，下来更麻烦

#### 迅雷下载解决方案
