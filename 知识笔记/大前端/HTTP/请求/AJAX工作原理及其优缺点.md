# AJAX工作原理及其优缺点

## 概述

	AJAX全称为“Asynchronous JavaScript and XML”（异步JavaScript和XML），是一种创建交互式网页应用的网页开发技术

#### 蕴含技术

* 使用XHTML+CSS来标准化呈现；

* 使用XML和XSLT进行数据交换及相关操作；

* 使用XMLHttpRequest对象与Web服务器进行异步数据通信； 

* 使用Javascript操作Document Object Model进行动态显示及交互； 

* 使用JavaScript绑定和处理所有数据。

#### 传统的web应用的问题

	传统的Web应用交互由用户触发一个HTTP请求到服务器，服务器对其进行处理后再返回一个新的HTML页到客户端， 每当服务器处理客户端提交的请求时，客户都只能空闲等待，并且哪怕只是一次很小的交互、只需从服务器端得到很简单的一个数据，都要返回一个完整的HTML页，而用户每次都要浪费时间和带宽去重新读取整个页面。

* 很明显，这个做法浪费了许多带宽，由于每次应用的交互都需要向服务器发送请求，应用的响应时间就依赖于服务器的响应时间。这导致了用户界面的响应比本地应用慢得多

#### 对比使用AJAX的好处

	AJAX应用可以仅向服务器发送并取回必需的数据，它使用SOAP或其它一些基于XML的Web Service接口，并在客户端采用JavaScript处理来自服务器的响应。因为在服务器和浏览器之间交换的数据大量减少，结果我们就能看到响应更快的应用。同时很多的处理工作可以在发出请求的客户端机器上完成，所以Web服务器的处理时间也减少了

## AJAX工作原理

	Ajax的工作原理相当于：在用户和服务器之间加了—个中间层(AJAX引擎),使用户操作与服务器响应异步化。并不是所有的用户请求都提交给服务器,像—些数据验证和数据处理等都交给Ajax引擎自己来做, 只有确定需要从服务器读取新数据时再由Ajax引擎代为向服务器提交请求

#### Ajax核心 

	AJAX主要由JavaScript、XmlHttpRequest、DOM对象组成

* 通过XmlHttpRequest对象来向服务器发异步请求，从服务器获得数据，然后用JavaScript来操作DOM而更新页面

> 这其中最关键的一步就是从服务器获得请求数据

###### XmlHttpRequest对象

	Ajax的一个最大的特点是无需刷新页面便可向服务器传输或读写数据(也就是我们常说的局部更新数据)

	而这一特点主要得益于XmlHttp组件XmlHttpPRequest对象

**XMLHttpRequest 对象方法**

|方    法|描    述|
|:---:|:---:|
|abort()|停止当前请求|
|getAllResponseHeaders()|把HTTP请求的所有响应首部作为键/值对返回|
|getResponseHeader("header")|返回指定首部的串值|
|open("method","URL",[asyncFlag],["userName"],["password"])|建立对服务器的调用。method参数可以是GET、POST或PUT。url参数可以是相对URL或绝对URL。这个方法还包括3个可选的参数，是否异步，用户名，密码|
|send(content)|向服务器发送请求|
|setRequestHeader("header", "value")|把指定首部设置为所提供的值。在设置任何首部之前必须先调用open()。设置header并和请求一起发送 ('post'方法一定要)|

**XMLHttpRequest对象属性**

|属  性|描    述|
|:---:|:---:|
|onreadystatechange|状态改变的事件触发器，每个状态改变时都会触发这个事件处理器，通常会调用一个JavaScript函数|
|readyState|请求的状态。有5个可取值：0 = 未初始化，1 = 正在加载，2 = 已加载，3 = 交互中，4 = 完成|
|responseText|服务器的响应，返回数据的文本。|
|responseXML|服务器的响应，返回数据的兼容DOM的XML文档对象 ，这个对象可以解析为一个DOM对象。|
|responseBody|服务器返回的主题（非文本格式）|
|responseStream|服务器返回的数据流|
|status|服务器的HTTP状态码（如：404 = "文件末找到" 、200 ="成功" ，等等）|
|statusText|服务器返回的状态文本信息 ，HTTP状态码的相应文本（OK或Not Found（未找到）等等）|

###### JavaScript

	JavaScript是一在浏览器中大量使用的编程语言，chrome浏览器由V8引擎提供对JavaScript的支持，当然其他浏览器还有一些比较出名的引擎：IE: Chakra、Firefox: TraceMonkey、Safari: Nitro。。。

###### DOM Document Object Model

	DOM是给HTML和XML文件使用的一组API。它提供了文件的结构表述，让你可以改变其中的內容及可见物
	其本质是建立网页与Script或程序语言沟通的桥梁
	所有WEB开发人员可操作及建立文件的属性、方法及事件都以对象来展现（例如，document就代表“文件本身“这个对像，table对象则代表HTML的表格对象等等）。这些对象可以由当今大多数的浏览器以Script来取用。
	一个用HTML或XHTML构建的网页也可以看作是一组结构化的数据，这些数据被封在DOM（Document Object Model）中，DOM提供了网页中各个对象的读写的支持

###### XML

	可扩展的标记语言（Extensible Markup Language）
	具有一种开放的、可扩展的、可自描述的语言结构，它已经成为网上数据和文档传输的标准，用于其他应用程序交换数据，当然，现在比较流行JSON等格式了

###### 总结

1. Ajax引擎，实际上是一个比较复杂的JavaScript应用程序，用来处理用户请求，读写服务器和更改DOM内容

2. JavaScript的Ajax引擎读取信息，并且互动地重写DOM，这使网页能无缝化重构，也就是在页面已经下载完毕后改变页面内容，这是我们一直在通过JavaScript和DOM在广泛使用的方法，但要使网页真正动态起来，不仅要内部的互动，还需要从外部获取数据

3. 很久以前，我们是让用户来输入数据并通过DOM来改变网页内容的，但现在，XmlHttpRequest，而当我们有了AJAX后，可以让我们在不重载页面的情况下读写服务器上的数据，使用户的输入达到最少

> Ajax使WEB中的界面与应用分离（也可以说是数据与呈现分离），而在以前两者是没有清晰的界限的，数据与呈现分离的分离，有利于分工合作、减少非技术人员对页面的修改造成的WEB应用程序错误、提高效率、也更加适用于现在的发布系统。也可以把以前的一些服务器负担的工作转嫁到客户端，利于客户端闲置的处理能力来处理

!> 注：这也就是现在最流行的方式，Vue框架就是一种代表，数据驱动承担更多的任务，分担服务器的负担

## AJAX的优缺点

#### AJAX的优点

1. 无刷新更新数据

	AJAX最大优点就是能在不刷新整个页面的前提下与服务器通信维护数据。这使得Web应用程序更为迅捷地响应用户交互，并避免了在网络上发送那些没有改变的信息，减少用户等待时间，带来非常好的用户体验

2. 异步与服务器通信

	AJAX使用异步方式与服务器通信，不需要打断用户的操作，具有更加迅速的响应能力。优化了Browser和Server之间的沟通，减少不必要的数据传输、时间及降低网络上数据流量

3. 前端和后端负载平衡

	AJAX可以把以前一些服务器负担的工作转嫁到客户端，利用客户端闲置的能力来处理，减轻服务器和带宽的负担，节约空间和宽带租用成本。并且减轻服务器的负担，AJAX的原则是“按需取数据”，可以最大程度的减少冗余请求和响应对服务器造成的负担，提升站点性能

4. 基于标准被广泛支持

	AJAX基于标准化的并被广泛支持的技术，不需要下载浏览器插件或者小程序，但需要客户允许JavaScript在浏览器上执行，而对于现在来说已经不是问题了。

> AJAX现在已经作为标准化的HTTP请求技术，基本所有HTTP请求都使用AJAX或用封装过的AJAX，当然也有类似AJAX的东东，例如现在前端常用的axios

5. 界面与应用分离

	Ajax使WEB中的界面与应用分离（也可以说是数据与呈现分离），有利于分工合作、减少非技术人员对页面的修改造成的WEB应用程序错误、提高效率、也更加适用于现在的发布系统

#### AJAX的缺点

1. AJAX干掉了Back和History功能，即对浏览器机制的破坏

	在动态更新页面的情况下，用户无法回到前一个页面状态，因为浏览器仅能记忆历史记录中的静态页面。一个被完整读入的页面与一个已经被动态修改过的页面之间的差别非常微妙；用户通常会希望单击后退按钮能够取消他们的前一次操作，但是在Ajax应用程序中，这将无法实现

	后退按钮是一个标准的web站点的重要功能，但是它没法和js进行很好的合作。这是Ajax所带来的一个比较严重的问题，因为用户往往是希望能够通过后退来取消前一次操作的

> 当然，这个问题是有得解决的，例如：用户单击后退按钮访问历史记录时，通过创建或使用一个隐藏的IFRAME来重现页面上的变更。但是这个解决方案并不能改变Ajax的机制。而现在最流行也最常用的就是URL片断标识符（通常被称为锚点，即URL中#后面的部分）来保持跟踪，允许用户回到指定的某个应用程序状态，参考Vue-router的History模式

2. AJAX的安全问题

	AJAX技术给用户带来很好的用户体验的同时也对IT企业带来了新的安全威胁，Ajax技术就如同对企业数据建立了一个直接通道。这使得开发者在不经意间会暴露比以前更多的数据和服务器逻辑。Ajax的逻辑可以对客户端的安全扫描技术隐藏起来，允许黑客从远端服务器上建立新的攻击。还有Ajax也难以避免一些已知的安全弱点，诸如跨站点脚步攻击、SQL注入攻击和基于Credentials的安全漏洞等等

> 虽然已经有很多解决方案，但是根源问题还在，漏洞层出不穷，都是见招拆招

3. 对搜索引擎支持较弱

4. 破坏程序的异常处理机制

5. 违背了URL和资源定位的初衷

	例如，我给你一个URL地址，如果采用了Ajax技术，也许你在该URL地址下面看到的和我在这个URL地址下看到的内容是不同的。这个和资源定位的初衷是相背离的

6. AJAX不能很好支持移动设备

	当然，现在已经有解决方案了

7. 客户端过肥，太多客户端代码造成开发上的成本

	编写复杂、容易出错 ；冗余代码比较多（层层包含js文件是AJAX的通病，再加上以往的很多服务端代码现在放到了客户端）；破坏了Web的原有标准

## AJAX使用场景

	Ajax开发时，网络延迟——即用户发出请求到服务器发出响应之间的间隔——需要慎重考虑。不给予用户明确的回应，没有恰当的预读数据，或者对XMLHttpRequest的不恰当处理，都会使用户感到延迟，这是用户不希望看到的，也是他们无法理解的。

> 通常的解决方案是，使用一个可视化的组件来告诉用户系统正在进行后台操作并且正在读取数据和内容，也就是进度条，给用户一种过程感，缓解用户以为等了很久

#### 适用场景

1. 表单驱动的交互

2. 深层次的树的导航

3. 快速的用户与用户间的交流响应

4. 类似投票、yes/no等无关痛痒的场景

5. 对数据进行过滤和操纵相关数据的场景

6. 普通的文本输入提示和自动完成的场景

#### 不适用场景

1. 部分简单的表单

2. 搜索

3. 基本的导航

4. 替换大量的文本

5. 对呈现的操纵

> 参考：[AJAX工作原理及其优缺点](https://www.cnblogs.com/SanMaoSpace/archive/2013/06/15/3137180.html)
